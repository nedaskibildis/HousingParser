(function(n){typeof define=="function"&&define.amd?define(["knockout"],n):typeof module=="object"&&module.exports?module.exports=n(require("ko")):n(ko)})(function(n){function w(n){var t,i;for(n=n||{},t=1;t<arguments.length;t++)if(arguments[t])for(i in arguments[t])arguments[t].hasOwnProperty(i)&&(n[i]=arguments[t][i]);return n}function u(n,t,i){var r=n.className.split(" "),u=r.indexOf(t);u>=0&&!i&&r.splice(u,1);u<0&&i&&r.push(t);n.className=r.join(" ")}function b(n,t){if(!n.tagName)return null;var i=document.documentElement,r=i.matches||i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;return r.call(n,t)}function k(n,t){do{if(b(n,t))return n;n=n.parentNode}while(n);return null}function f(n){this.init(n)}function t(n,t){return n.type.indexOf("touch")>=0?n.changedTouches[0][t]:n[t]}function l(n){this.init(n);this.drop=function(t){n.drop(t,n.data)}}function c(n){this.element=n;u(this.element,"drag-element",!0);this.element.style.position="fixed";this.element.style.zIndex=9998;this.element.addEventListener("selectstart",function(){return!1},!0)}function e(n){this.element=n.element;this.name=n.name;this.dragStart=n.dragStart;this.dragEnd=n.dragEnd;this.data=n.data}function o(n,t){var i=n.getBoundingClientRect();this.element=n;this.scrollMarginHeight=Math.floor(i.height/10);this.scrollMarginWidth=Math.floor(i.width/10);this.offset={top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft};this.innerHeight=i.height;this.innerWidth=i.width;this.scrollDeltaMin=5;this.scrollDeltaMax=30;this.delay=t||0;this.inZone="center";this.scrolling=!1}function a(n){if(n.accepts)return[].concat(n.accepts);if(n.name)return[n.name];throw new Error("A drop zone must specify the drag zones it accepts");}var i={},r={},s=n.utils.arrayForEach,v=n.utils.arrayFirst,y=n.utils.arrayFilter,p="ontouchstart"in document.documentElement,h=!1;f.prototype.init=function(n){this.element=n.element;this.data=n.data;this.dragEnter=n.dragEnter;this.dragOver=n.dragOver;this.dragLeave=n.dragLeave;this.active=!1;this.inside=!1;this.dirty=!1};f.prototype.refreshDomInfo=function(){if(this.hidden=this.element.style.display==="none",!this.hidden){var n=this.element.getBoundingClientRect();this.top=n.top+window.pageYOffset-document.documentElement.clientTop;this.left=n.left+window.pageXOffset-document.documentElement.clientLeft;this.width=n.width;this.height=n.height}};f.prototype.isInside=function(n,t){return this.hidden?!1:n<this.left||t<this.top?!1:this.left+this.width<n?!1:this.top+this.height<t?!1:!0};f.prototype.update=function(n,i){this.isInside(t(n,"pageX"),t(n,"pageY"))?(this.inside||this.enter(n,i),this.dragOver&&this.dragOver(n,i,this.data)):this.leave(n)};f.prototype.enter=function(n,t){this.inside=!0;this.active=this.dragEnter?this.dragEnter(n,t,this.data)!==!1:!0;this.dirty=!0};f.prototype.leave=function(n){n&&(n.target=this.element);this.inside&&this.dragLeave&&this.dragLeave(n,this.data);this.active=!1;this.inside=!1;this.dirty=!0};l.prototype=f.prototype;l.prototype.updateStyling=function(){this.dirty&&(u(this.element,"drag-over",this.active),u(this.element,"drop-rejected",this.inside&&!this.active));this.dirty=!1};c.prototype.updatePosition=function(n){this.element.style.top=n.pageY-window.pageYOffset+"px";this.element.style.left=n.pageX-window.pageXOffset+"px";this.element.style.top=t(n,"pageY")-window.pageYOffset+"px";this.element.style.left=t(n,"pageX")-window.pageXOffset+"px"};c.prototype.remove=function(){n.removeNode(this.element)};e.prototype.startDrag=function(n){if(this.dragStart&&this.dragStart(this.data,n)===!1)return!1;u(document.body,"drag-active",!0)};e.prototype.drag=function(n){var f=this,t=this.name,u=i[t].concat(r[t]);s(u,function(n){n.refreshDomInfo()});s(u,function(t){n.target=t.element;t.update(n,f.data)});s(i[t],function(n){n.updateStyling()})};e.prototype.dropRejected=function(){var n=this.name,t=v(i[n],function(n){return n.inside});return t?!v(i[n],function(n){return n.active}):!0};e.prototype.cancelDrag=function(n){this.dragEnd&&this.dragEnd(this.data,n);u(document.body,"drag-active",!1)};e.prototype.drop=function(n){var t=this.name,e=k(n.target,".drop-zone"),o=y(i[t],function(n){return n.active}),f=y(o,function(n){return n.element===e})[0];s(i[t].concat(r[t]),function(t){t.leave(n)});s(i[t],function(n){n.updateStyling()});f&&f.drop&&f.drop(this.data);this.dragEnd&&this.dragEnd(this.data,n);u(document.body,"drag-active",!1)};o.prototype.scroll=function(n,t){this.x=n;this.y=t;this.topLimit=this.scrollMarginHeight+this.offset.top;this.bottomLimit=this.offset.top+this.innerHeight-this.scrollMarginHeight;this.leftLimit=this.scrollMarginWidth+this.offset.left;this.rightLimit=this.offset.left+this.innerWidth-this.scrollMarginWidth;var i="";t<this.topLimit?i+="top":t>this.bottomLimit&&(i+="bottom");n<this.leftLimit?i+="left":n>this.rightLimit&&(i+="right");i===""&&(i="center");this.updateZone(i)};o.prototype.enter=function(){var n=this;this.delayTimer=setTimeout(function(){n.scrolling=!0},this.delay)};o.prototype.leave=function(){this.scrolling=!1;clearTimeout(this.delayTimer)};o.prototype.over=function(n){var t,i=function(n){return n*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin}.bind(this);this.scrolling&&(n.indexOf("top")!==-1?(t=(this.topLimit-this.y)/this.scrollMarginHeight,this.element.scrollTop-=i(t)):n.indexOf("bottom")!==-1&&(t=(this.y-this.bottomLimit)/this.scrollMarginHeight,this.element.scrollTop+=i(t)),n.indexOf("left")!==-1?(t=(this.leftLimit-this.x)/this.scrollMarginWidth,this.element.scrollLeft-=i(t)):n.indexOf("right")!==-1&&(t=(this.x-this.rightLimit)/this.scrollMarginWidth,this.element.scrollLeft+=i(t)))};o.prototype.updateZone=function(n){this.zone!==n&&(this.leave(this.zone),this.enter(n));this.zone=n;this.over(n)};n.utils.extend(n.bindingHandlers,{dropZone:{init:function(t,r,f,e,o){var s=n.utils.unwrapObservable(r()),c=a(s),v,h;u(t,"drop-zone",!0);v=s.data||o&&o.$data;h=new l({element:t,data:v,drop:s.drop,dragEnter:s.dragEnter,dragOver:s.dragOver,dragLeave:s.dragLeave});c.forEach(function(n){i[n]=i[n]||[];i[n].push(h)});n.utils.domNodeDisposal.addDisposeCallback(t,function(){h.leave();c.forEach(function(n){i[n].splice(i[n].indexOf(h),1)})})}},dragEvents:{init:function(t,i,u,e,o){var s=n.utils.unwrapObservable(i()),c=a(s),l=s.data||o&&o.$data,h=new f({element:t,data:l,dragEnter:s.dragEnter,dragOver:s.dragOver,dragLeave:s.dragLeave});c.forEach(function(n){r[n]=r[n]||[];r[n].push(h)});n.utils.domNodeDisposal.addDisposeCallback(t,function(){h.leave();c.forEach(function(n){r[n].splice(r[n].indexOf(h),1)})})}},dragZone:{init:function(f,o,s,l,a){function tt(){var n=f.cloneNode(!0),t;return f.parentNode.appendChild(n),t=window.getComputedStyle(f,null),n.style.height=t.getPropertyValue("height"),n.style.width=t.getPropertyValue("width"),n.style.opacity=70/100,n.style.filter="alpha(opacity=70)",n}function it(){var t=document.createElement("div"),i;return document.body.appendChild(t),i="data"in v?a.createChildContext(v.data):a,n.renderTemplate(v.element,i,{},t),t}function k(n){n.preventDefault();n.stopPropagation()}function nt(i){function l(n){function nt(n){b.drag(n);var t=b.dropRejected();t!==g&&(u(f,"drop-rejected",t),f.style.cursor=t?"no-drop":"move",g=t);a=setTimeout(function(){nt(n)},100)}function rt(n){return h=!1,clearTimeout(e),clearTimeout(a),l&&l.remove(),f.parentNode.removeChild(f),b.cancelDrag(n),document.removeEventListener("touchmove",y),document.removeEventListener("touchend",d),n.preventDefault(),n.stopPropagation(),!0}function y(n){return n.button>0?rt(n):(clearTimeout(a),l&&l.updatePosition(n),nt(n),n.preventDefault(),n.stopPropagation(),!1)}function d(n){h=!1;clearTimeout(e);clearTimeout(a);l&&l.remove();f.parentNode.removeChild(f);var i=w({},n);return i.target=document.elementFromPoint(t(n,"clientX"),t(n,"clientY")),b.drop(i),document.removeEventListener("selectstart",k,!0),document.removeEventListener("touchmove",y),document.removeEventListener("touchend",d),n.preventDefault(),n.stopPropagation(),!1}var l,f,a,g;if(document.removeEventListener("mouseup",r,!0),document.removeEventListener("touchend",r,!0),document.removeEventListener("click",r,!0),document.removeEventListener("mousemove",o,!0),document.removeEventListener("touchmove",s,!0),h)return!0;if(b.startDrag(i)===!1)return n.preventDefault(),n.stopPropagation(),!1;h=!0;l=null;typeof v.element=="undefined"&&(l=new c(tt()));f=document.createElement("div");f.className="drag-overlay";f.setAttribute("unselectable","on");f.style.zIndex=9999;f.style.position="fixed";f.style.top=0;f.style.left=0;f.style.right=0;f.style.bottom=0;f.style.cursor="move";f.style.backgroundColor="white";f.style.opacity=0;f.style.filter="alpha(opacity=0)";f.style.userSelect="none";f.style.webkitUserSelect="none";f.style.MozUserSelect="none";f.style.msUserSelect="none";f.style.OUserSelect="none";f.addEventListener("selectstart",k);document.body.appendChild(f);v.element&&(l=new c(it()));l&&l.updatePosition(i);a=null;g=!1;p||f.addEventListener("mousedown",rt);f.addEventListener("mousemove",y);document.addEventListener("touchmove",y);f.addEventListener("mouseup",d);document.addEventListener("touchend",d)}function r(){return document.removeEventListener("mouseup",r,!0),document.removeEventListener("touchend",r,!0),document.removeEventListener("click",r,!0),document.removeEventListener("mousemove",o,!0),document.removeEventListener("touchmove",s,!0),document.removeEventListener("selectstart",k,!0),!0}function o(n){if(n.target.tagName&&n.target.tagName.toLowerCase()==="input")return!0;var r=t(i,"pageX")-t(n,"pageX"),u=t(i,"pageY")-t(n,"pageY"),f=Math.sqrt(Math.pow(r,2)+Math.pow(u,2));return f>d&&l(n),n.preventDefault(),n.stopPropagation(),!1}function s(n){if(n.target.tagName&&n.target.tagName.toLowerCase()==="input")return!0;var r=t(i,"pageX")-t(n,"pageX"),u=t(i,"pageY")-t(n,"pageY"),f=Math.sqrt(Math.pow(r,2)+Math.pow(u,2));f>d&&clearTimeout(e)}if(i.button>0)return!0;document.addEventListener("selectstart",k,!0);document.addEventListener("mouseup",r,!0);document.addEventListener("touchend",r,!0);document.addEventListener("click",r,!0);var e;return i.type==="touchstart"&&(e=setTimeout(function(){l(i)},n.unwrap(v.longTapDelay)),f.addEventListener("touchend",function(){clearTimeout(e)})),document.addEventListener("mousemove",o,!0),document.addEventListener("touchmove",s,!0),!0}var v=n.utils.unwrapObservable(o()),y=v.name,d=typeof v.dragDistance=="number"?v.dragDistance:10,g,b;if(i[y]=i[y]||[],r[y]=r[y]||[],!y||typeof y!="string")throw new Error("A drag zone must specify a name");v.disabled||(g=v.data||a&&a.$data,b=new e({element:f,name:y,data:g,dragStart:v.dragStart,dragEnd:v.dragEnd}),typeof v.longTapDelay=="undefined"&&(v.longTapDelay=500),f.addEventListener("selectstart",function(n){return!n.target.tagName||n.target.tagName.toLowerCase()!=="input"&&n.target.tagName.toLowerCase()!=="textarea"?(n.preventDefault(),n.stopPropagation(),!1):!0},!0),u(f,"draggable",!0),f.addEventListener("mousedown",nt),f.addEventListener("touchstart",nt),n.utils.domNodeDisposal.addDisposeCallback(f,function(){document.removeEventListener("selectstart",k,!0)}))}},scrollableOnDragOver:{init:function(i,r){function l(){f.scroll(s,h)}function v(){f=new o(i,u.delay);c=setInterval(l,100)}function y(n){s=t(n,"pageX");h=t(n,"pageY")}function p(){clearInterval(c)}var u=n.utils.unwrapObservable(r()),e,f,s,h,c;(typeof u=="string"||Array.isArray(u))&&(u={accepts:u});u.delay=u.delay||0;e=a(u);f=null;n.bindingHandlers.dragEvents.init(i,function(){return{accepts:e,dragEnter:v,dragOver:y,dragLeave:p}})}}})})